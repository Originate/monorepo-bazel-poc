# Scalable Build System POC

This is a proof of concept of a mono-repo compiled by the
[scalabel Bazel build system](https://bazel.build).

### Install

- clone this repo

### Compile

1. Compile a Java library:

   ```
   bazel build //src/com/acme/shared/hello
   ```

   This creates `bazel-bin/src/com/acme/shared/hello/libhello.jar`.

2. Compile a SpringBoot micro-service including all dependencies

   ```
   bazel build //src/com/acme/web:Web
   ```

3. compile everything:

   ```
   bazel build //...
   ```

To start over, run `bazel clean` to remove all build artifacts.

### Run

Start the micro-service:

```
bazel-bin/src/com/acme/web/Web
```

### Change

- change the `com.acme.shared.Hello` method to return "Hello world"
- see that it recompiles only this library

### Maintain

- install the [Bazel build tools](https://github.com/bazelbuild/buildtools)
  (your IDE might do that for you)
- fix all lint errors in Bazel BUILD files:

      buildifier --lint=fix -warnings=native-java -r path/to/your/workspace/root/dir

### Analyze

What are the dependencies of the `//src/com/acme/web:Web` package:

```
bazel query "deps(//src/com/acme/web:Web)" --output package
```

Which folders need to be present to build the `//src/com/acme/web:Web` package:

```
bazel query "buildfiles(deps(//src/com/acme/web:Web))" --output package

src/com/acme/shared
src/com/acme/web
src/frontend
```

What files are generated by rules in the `//src/com/acme/web` package:

```
bazel query 'kind("generated file", //src/com/acme/web:*)'

//src/com/acme/web:Web_deploy.jar
//src/com/acme/web:Web_deploy-src.jar
//src/com/acme/web:Web.jar
//src/com/acme/web:Web-src.jar
```

Which package contains the file `src/com/acme/web/Web.java`:

```
bazel query src/com/acme/web/Web.java --output package

//src/com/acme/web
```

[more info](https://docs.bazel.build/versions/master/query-how-to.html)
